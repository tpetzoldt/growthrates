<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Estimation of Growth Rates with Package `growthrates`, Part 2: User-defined Growth Models • growthrates</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Estimation of Growth Rates with Package `growthrates`, Part 2: User-defined Growth Models">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">growthrates</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.8.6</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Introduction.html">Estimation of Growth Rates with Package `growthrates`, Part 1: Introduction</a></li>
    <li><a class="dropdown-item" href="../articles/User_models.html">Estimation of Growth Rates with Package `growthrates`, Part 2: User-defined Growth Models</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/tpetzoldt/growthrates/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Estimation of Growth Rates with Package `growthrates`, Part 2: User-defined Growth Models</h1>
                        <h4 data-toc-skip class="author">Thomas
Petzoldt</h4>
            
            <h4 data-toc-skip class="date">2025-08-28</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/tpetzoldt/growthrates/blob/master/vignettes/User_models.Rmd" class="external-link"><code>vignettes/User_models.Rmd</code></a></small>
      <div class="d-none name"><code>User_models.Rmd</code></div>
    </div>

    
    
<!--
possible output options are:
rmarkdown::pdf_document
rmarkdown::html_vignette

set to UTF if necessary with:
%\VignetteEncoding{UTF-8}

Bibliographies may need to set the LANG environment variable
LANG=en_US.UTF-8
-->
<div class="section level2">
<h2 id="introduction">1. Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Package <strong>growthrates</strong> comes with a set of pararametric
growth models built-in, that should be sufficient for many application
scenarios, but of course not under all circumstances. This document
describes how the set of available functions can be extended with own
user-defined models. Section (3) describes how simple regression
functions existing in a <em>closed form</em> can be implemented. In
Section (4) we will see how growth models defined by systems of ordinary
differential equations (ODE) can be implemented directy in R and finally
Section (5) describes how ODE models can be implemented as C inline
functions.</p>
</div>
<div class="section level2">
<h2 id="differential-equations-or-closed-form">2. Differential equations or closed form?<a class="anchor" aria-label="anchor" href="#differential-equations-or-closed-form"></a>
</h2>
<p>Growth models can be either “ordinary functions” of time
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">f(t)</annotation></semantics></math>
in <em>closed form</em>, that a allow to get values for the dependend
variable
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>y</mi><annotation encoding="application/x-tex">y</annotation></semantics></math>
immediately from any given value of an independent variable
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>
(or
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mi>i</mi><mi>m</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">time</annotation></semantics></math>)
without the need of iteration. Or, they can be a differential equation
model
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>y</mi><mi>/</mi><mi>d</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">dy/dt</annotation></semantics></math>
that needs numerical integration.</p>
<p>Sometimes, a model can be given in either of these forms. As an
example, the logistic growth model can be written as a differential
equation:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mrow><mi>d</mi><mi>y</mi></mrow><mrow><mi>d</mi><mi>t</mi></mrow></mfrac><mo>=</mo><msub><mi>μ</mi><mrow><mi>m</mi><mi>a</mi><mi>x</mi></mrow></msub><mo>⋅</mo><mi>y</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>−</mo><mfrac><mi>y</mi><mi>K</mi></mfrac><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\frac{dy}{dt} = \mu_{max} \cdot y \left(1 - \frac{y}{K}\right)</annotation></semantics></math></p>
<p>or as its analytical solution in closed form:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mfrac><mrow><mi>K</mi><mo>⋅</mo><msub><mi>y</mi><mn>0</mn></msub></mrow><mrow><msub><mi>y</mi><mn>0</mn></msub><mo>+</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>K</mi><mo>−</mo><msub><mi>y</mi><mn>0</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>⋅</mo><msup><mi>e</mi><mrow><mo>−</mo><msub><mi>μ</mi><mrow><mi>m</mi><mi>a</mi><mi>x</mi></mrow></msub><mo>⋅</mo><mi>t</mi></mrow></msup></mrow></mfrac></mrow><annotation encoding="application/x-tex">y(t) = \frac{K \cdot y_0}{y_0 + (K - y_0) \cdot e^{-\mu_{max} \cdot t}}</annotation></semantics></math></p>
<p>We see, that it is much easier to use the second form, because
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>y</mi><annotation encoding="application/x-tex">y</annotation></semantics></math>
can immediately be calculated from
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>,
while for the first version, we would need either calculus (and get the
second form as its solution), or we could use a numerical method to
simulate the evolution of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>y</mi><annotation encoding="application/x-tex">y</annotation></semantics></math>
stepwise over time.</p>
<p>But on the other hand, models given as differential equations are
often more directly related to a mechanistic process description and
easier to extended.</p>
</div>
<div class="section level2">
<h2 id="growth-models-in-closed-form">3. Growth models in closed form<a class="anchor" aria-label="anchor" href="#growth-models-in-closed-form"></a>
</h2>
<p>Let’s assume we want to extend the logistic growth model with an
additional shift parameter in
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>y</mi><annotation encoding="application/x-tex">y</annotation></semantics></math>
direction, for example, because a part of the population does not
participate growing. This leads to an equation like:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mfrac><mrow><mi>K</mi><mo>⋅</mo><msub><mi>y</mi><mn>0</mn></msub></mrow><mrow><msub><mi>y</mi><mn>0</mn></msub><mo>+</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>K</mi><mo>−</mo><msub><mi>y</mi><mn>0</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>⋅</mo><msup><mi>e</mi><mrow><mo>−</mo><msub><mi>μ</mi><mrow><mi>m</mi><mi>a</mi><mi>x</mi></mrow></msub><mi>t</mi></mrow></msup></mrow></mfrac><mo>+</mo><msub><mi>y</mi><mrow><mi>s</mi><mi>h</mi><mi>i</mi><mi>f</mi><mi>t</mi></mrow></msub></mrow><annotation encoding="application/x-tex">y(t) = \frac{K \cdot y_0}{y_0 + (K - y_0) \cdot e^{-\mu_{max} t}} + y_{shift}</annotation></semantics></math></p>
<p>After loading package growthrates:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/tpetzoldt/growthrates" class="external-link">"growthrates"</a></span><span class="op">)</span></span></code></pre></div>
<p>we can immediately define our own function in the user workspace,
without modifying the package itself. In order to make it compatible
with package growthrates, it is sufficient to streamline the input and
output interfaces in the style described in help page
<code><a href="../reference/growthmodel-constructor.html">?growthmodel</a></code>.</p>
<p>The function can have any valid name, but:</p>
<ol style="list-style-type: decimal">
<li>it must have exactly two arguments <strong>time</strong> and
<strong>parms</strong> as input and</li>
<li>its return value (output) must be a matrix with at least 2 columns
with the column names <code>time</code> and <code>y</code>.</li>
</ol>
<p>The inner part of the function can be adapted as necessary, as long
as the connection between input and output makes sense from a scientific
viewpoint.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">grow_logistic_yshift</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">time</span>, <span class="va">parms</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="va">parms</span><span class="op">)</span>, <span class="op">{</span></span>
<span>    <span class="va">y</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">K</span> <span class="op">*</span> <span class="va">y0</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">y0</span> <span class="op">+</span> <span class="op">(</span><span class="va">K</span> <span class="op">-</span> <span class="va">y0</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">mumax</span> <span class="op">*</span> <span class="va">time</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="va">y_shift</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>time <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>The, at a first look, circumstantial
<code>as.matrix(data.frame(()))</code> construction is just a simple way
to create the required output format.</p>
<p>Then it is of course wise to test the function beforehand, for
example:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">time</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu">grow_logistic_yshift</span><span class="op">(</span><span class="va">time</span>, parms <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>y0 <span class="op">=</span> <span class="fl">1</span>, mumax <span class="op">=</span> <span class="fl">0.5</span>, K <span class="op">=</span> <span class="fl">10</span>, y_shift <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">out</span><span class="op">[</span>, <span class="st">"y"</span><span class="op">]</span>, type <span class="op">=</span> <span class="st">"b"</span><span class="op">)</span></span></code></pre></div>
<p><img src="User_models_files/figure-html/unnamed-chunk-4-1.png" width="480"></p>
<p>Future versions of the growthrates package may introduce additional
checks, so it is already a good idea to convert the function into an
appropriate object of class <code>growthmodel</code> with a so-called
constructor function of the same name:</p>
<pre><code><span><span class="va">grow_logistic_yshift</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/growthmodel-constructor.html">growthmodel</a></span><span class="op">(</span><span class="va">grow_logistic_yshift</span>,</span>
<span>                                    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"y0"</span>, <span class="st">"mumax"</span>, <span class="st">"K"</span>, <span class="st">"y_shift"</span><span class="op">)</span><span class="op">)</span></span></code></pre>
<p>Now the new model is ready to be fitted to test data:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">100</span>, <span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2.1</span>, <span class="fl">2.3</span>, <span class="fl">5</span>, <span class="fl">4.7</span>, <span class="fl">4.3</span>, <span class="fl">6.9</span>, <span class="fl">8.2</span>, <span class="fl">11.5</span>, <span class="fl">8.8</span>, <span class="fl">10.2</span>, <span class="fl">14.5</span>, <span class="fl">12.5</span>,</span>
<span>       <span class="fl">13.6</span>, <span class="fl">12.7</span>, <span class="fl">14.2</span>, <span class="fl">12.5</span>, <span class="fl">13.8</span>, <span class="fl">15.1</span>, <span class="fl">12.7</span>, <span class="fl">14.9</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_growthmodel.html">fit_growthmodel</a></span><span class="op">(</span><span class="va">grow_logistic_yshift</span>,</span>
<span>                       p <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>y0 <span class="op">=</span> <span class="fl">1</span>, mumax <span class="op">=</span> <span class="fl">0.1</span>, K <span class="op">=</span> <span class="fl">10</span>, K <span class="op">=</span> <span class="fl">10</span>, y_shift <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>                       time <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span></code></pre></div>
<p><img src="User_models_files/figure-html/unnamed-chunk-5-1.png" width="480"></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Parameters:</span></span>
<span><span class="co">##         Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">## y0       0.86510    1.15526   0.749 0.464826    </span></span>
<span><span class="co">## mumax    0.08134    0.02737   2.972 0.008995 ** </span></span>
<span><span class="co">## K       12.99885    2.56970   5.059 0.000116 ***</span></span>
<span><span class="co">## y_shift  1.04939    2.22481   0.472 0.643528    </span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residual standard error: 1.248 on 16 degrees of freedom</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Parameter correlation:</span></span>
<span><span class="co">##              y0   mumax       K y_shift</span></span>
<span><span class="co">## y0       1.0000 -0.9632  0.9555 -0.9477</span></span>
<span><span class="co">## mumax   -0.9632  1.0000 -0.8989  0.8519</span></span>
<span><span class="co">## K        0.9555 -0.8989  1.0000 -0.9766</span></span>
<span><span class="co">## y_shift -0.9477  0.8519 -0.9766  1.0000</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="differential-equation-models-in-r">4. Differential equation models in R<a class="anchor" aria-label="anchor" href="#differential-equation-models-in-r"></a>
</h2>
<p>Differential equation models can be used quite similar to this. It is
a little bit more complex because:</p>
<ol style="list-style-type: decimal">
<li>we need two functions. One for the ODE model (the derivatives) and
one for the numerical integration.</li>
<li>the ODE model distinguishes between time dependent <em>state
variables</em> and constant <em>parameters</em>, that can both be
considered as <em>parameters</em> in a statistical sense. This
distinction between <strong>statistical parameters</strong> (from the
viewpoint of model fitting) and <strong>ODE model parameters</strong>
should not be confused.</li>
<li>the numerical integration itself is a broad field that needs
experience and care. A short overview on this topic can be found in
<span class="citation">Soetaert, Petzoldt, and Setzer
(2010)</span>.</li>
</ol>
<p>In the following, let’s assume a model where the carrying capacity is
a function of time. This can be modelled with a system of two
differential equations, one for the carrying capacity
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>K</mi><annotation encoding="application/x-tex">K</annotation></semantics></math>)
and another for the population abundance
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>y</mi><annotation encoding="application/x-tex">y</annotation></semantics></math>).
For sake of simplicity we assume a linear increase of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>K</mi><annotation encoding="application/x-tex">K</annotation></semantics></math>,
but more complex models are of course also possible, e.g. biochemical
conversion of a mixed substrate, Monod-dependency from a limited
resource, density dependence or a semi-continuos addition of
nutrients.</p>
<p>The growth model is built from two parts:</p>
<ol style="list-style-type: decimal">
<li>the function <code>ode_...</code> with the differential equations,
and</li>
<li>the growth model <code>grow_...</code> calculating the numerical
solution.</li>
</ol>
<p>In the latter, the statistical parameters are splitted into the
initial values for the states (<code>init</code>) and the ODE model
parameters. And, we need to distinguish between the initial (start)
values,
e.g. <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>y</mi><mn>0</mn></msub><annotation encoding="application/x-tex">y_0</annotation></semantics></math>
and the state variables
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>y</mi><annotation encoding="application/x-tex">y</annotation></semantics></math>
that change during simulation.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ode_K_linear</span> <span class="op">&lt;-</span> <span class="kw">function</span> <span class="op">(</span><span class="va">time</span>, <span class="va">init</span>, <span class="va">parms</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">parms</span>, <span class="va">init</span><span class="op">)</span><span class="op">)</span>, <span class="op">{</span></span>
<span>    <span class="va">dy</span> <span class="op">&lt;-</span> <span class="va">mumax</span> <span class="op">*</span> <span class="va">y</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">y</span><span class="op">/</span><span class="va">K</span><span class="op">)</span></span>
<span>    <span class="va">dK</span> <span class="op">&lt;-</span> <span class="va">dK</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">dy</span>, <span class="va">dK</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">grow_K_linear</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">time</span>, <span class="va">parms</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">init</span>    <span class="op">&lt;-</span> <span class="va">parms</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"y0"</span>, <span class="st">"K"</span><span class="op">)</span><span class="op">]</span>           <span class="co"># initial values</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">init</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"y"</span>, <span class="st">"K"</span><span class="op">)</span>               <span class="co"># force names of state variables</span></span>
<span>  <span class="va">odeparms</span> <span class="op">&lt;-</span> <span class="va">parms</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mumax"</span>, <span class="st">"dK"</span><span class="op">)</span><span class="op">]</span>      <span class="co"># the parms of the ODE model</span></span>
<span>  <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/deSolve/man/ode.html" class="external-link">ode</a></span><span class="op">(</span><span class="va">init</span>, <span class="va">time</span>, <span class="va">ode_K_linear</span>, parms <span class="op">=</span> <span class="va">odeparms</span><span class="op">)</span></span>
<span>  <span class="va">out</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Again, it’s a good idea to test this first:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">grow_K_linear</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/growthmodel-constructor.html">growthmodel</a></span><span class="op">(</span><span class="va">grow_K_linear</span>,</span>
<span>                             pnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"y0"</span>, <span class="st">"K"</span>, <span class="st">"mumax"</span>, <span class="st">"deltaK"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu">grow_K_linear</span><span class="op">(</span>time <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>y0 <span class="op">=</span> <span class="fl">.1</span>, K <span class="op">=</span> <span class="fl">1</span>, mumax <span class="op">=</span> <span class="fl">0.1</span>, dK <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##      time         y   K</span></span>
<span><span class="co">## [1,]    1 0.1000000 1.0</span></span>
<span><span class="co">## [2,]    2 0.1095851 1.5</span></span>
<span><span class="co">## [3,]    3 0.1203149 2.0</span></span>
<span><span class="co">## [4,]    4 0.1322238 2.5</span></span>
<span><span class="co">## [5,]    5 0.1453939 3.0</span></span>
<span><span class="co">## [6,]    6 0.1599322 3.5</span></span></code></pre>
<p>before we fit the model to data:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">100</span>, <span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">2.2</span>, <span class="fl">3.1</span>, <span class="fl">1.5</span>, <span class="fl">8.9</span>, <span class="fl">8</span>, <span class="fl">8.4</span>, <span class="fl">9.8</span>, <span class="fl">9.3</span>, <span class="fl">10.6</span>, <span class="fl">12</span>, <span class="fl">13.6</span>,</span>
<span>  <span class="fl">13.1</span>, <span class="fl">13.3</span>, <span class="fl">11.6</span>, <span class="fl">14.7</span>, <span class="fl">12.6</span>, <span class="fl">13.9</span>, <span class="fl">16.9</span>, <span class="fl">14.4</span><span class="op">)</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_growthmodel.html">fit_growthmodel</a></span><span class="op">(</span><span class="va">grow_K_linear</span>,</span>
<span>                       p <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>y0 <span class="op">=</span> <span class="fl">0.1</span>, mumax <span class="op">=</span> <span class="fl">0.2</span>, K <span class="op">=</span> <span class="fl">10</span>, dK <span class="op">=</span> <span class="fl">.1</span><span class="op">)</span>, time <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span></code></pre></div>
<p><img src="User_models_files/figure-html/unnamed-chunk-8-1.png" width="384"></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Parameters:</span></span>
<span><span class="co">##       Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">## y0     0.53286    0.55248   0.964 0.349157    </span></span>
<span><span class="co">## mumax  0.18124    0.07555   2.399 0.028988 *  </span></span>
<span><span class="co">## K      7.76895    1.65802   4.686 0.000248 ***</span></span>
<span><span class="co">## dK     0.08490    0.02375   3.575 0.002529 ** </span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residual standard error: 1.442 on 16 degrees of freedom</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Parameter correlation:</span></span>
<span><span class="co">##            y0   mumax       K      dK</span></span>
<span><span class="co">## y0     1.0000 -0.9211  0.5040 -0.3791</span></span>
<span><span class="co">## mumax -0.9211  1.0000 -0.6911  0.5596</span></span>
<span><span class="co">## K      0.5040 -0.6911  1.0000 -0.9528</span></span>
<span><span class="co">## dK    -0.3791  0.5596 -0.9528  1.0000</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="inline-c-code-with-package-code">5. Inline C code with package cOde<a class="anchor" aria-label="anchor" href="#inline-c-code-with-package-code"></a>
</h2>
<p>A numerical simulation of ODE models can sometimes be slow, so we may
be tempted to speed it up. This is indeed possible with <em>compiled
code</em>, i.e. the model is written in another programming language
(Fortran or C) that are faster compared to R. Several methods exist how
this can be done, see for example <span class="citation">Soetaert,
Petzoldt, and Setzer (2010)</span> or <span class="citation">Kneis
(2016)</span> and <span class="citation">Kneis, Petzoldt, and Berendonk
(2017)</span>. In the following, we use a method that allows <em>inline
code</em>, i.e. direkt integration of C code in the R script using
package <strong>cOde</strong> <span class="citation">(Kaschek
2016)</span>.</p>
<p>Note, however, that compiled code needs the necessary C (and/or
Fortran) compilers and some additional developer tools. These are often
installed on Linux systems by default, whereas the Windows toolset
available from <a href="https://cran.r-project.org/bin/windows/Rtools/" class="external-link uri">https://cran.r-project.org/bin/windows/Rtools/</a> needs an
additional installation.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## The following example shows how to use compiled growth models</span></span>
<span><span class="co">## from inline code, by using the 'cOde' package of Daniel Kaschek</span></span>
<span><span class="co">## Note: This example needs the R development tools.</span></span>
<span><span class="co">##  - suitable compilers on Linux and Mac</span></span>
<span><span class="co">##  - Rtools on Windows from https://cran.r-project.org/bin/windows/Rtools/</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/tpetzoldt/growthrates" class="external-link">"growthrates"</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st">"cOde"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## define a system of ODEs and compile it --------------------------------------</span></span>
<span><span class="va">ode_K_linear</span> <span class="op">&lt;-</span> <span class="fu">funC</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  y <span class="op">=</span> <span class="st">"mumax * y * (1-y/K)"</span>,</span>
<span>  K <span class="op">=</span> <span class="st">"dK"</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">yini</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fl">1</span>, K <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">parms</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>mumax <span class="op">=</span> <span class="fl">0.1</span>, dK <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## run the model</span></span>
<span><span class="va">out1</span> <span class="op">&lt;-</span> <span class="fu">odeC</span><span class="op">(</span><span class="va">yini</span>, times <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">100</span>, <span class="va">ode_K_linear</span>, parms <span class="op">=</span> <span class="va">parms</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## generate artificial test data with normal distributed noise</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">100</span>, <span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu">odeC</span><span class="op">(</span><span class="va">yini</span>, <span class="va">x</span>, <span class="va">ode_K_linear</span>, <span class="va">parms</span><span class="op">)</span><span class="op">[</span>, <span class="st">"y"</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">## create a "growthmodel" with interfaces compatible to package growthrates</span></span>
<span><span class="co">## It is essential to use consistent names for parameters and initial values!</span></span>
<span></span>
<span><span class="va">grow_K_linear</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">time</span>, <span class="va">parms</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">init</span>    <span class="op">&lt;-</span> <span class="va">parms</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"y0"</span>, <span class="st">"K"</span><span class="op">)</span><span class="op">]</span>  <span class="co"># initial values</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">init</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"y"</span>, <span class="st">"K"</span><span class="op">)</span>      <span class="co"># force names</span></span>
<span>  <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu">odeC</span><span class="op">(</span><span class="va">init</span>, <span class="va">time</span>, <span class="va">ode_K_linear</span>, <span class="va">parms</span><span class="op">)</span></span>
<span>  <span class="va">out</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">## convert this to an object, (maybe needed by future extensions)</span></span>
<span><span class="va">grow_K_linear</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/growthmodel-constructor.html">growthmodel</a></span><span class="op">(</span><span class="va">grow_K_linear</span>, pnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"y0"</span>, <span class="st">"mumax"</span>, <span class="st">"K"</span>, <span class="st">"dK"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Test the growthmodel</span></span>
<span><span class="co">## Columns with names 'time' and 'y' are mandatory.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu">grow_K_linear</span><span class="op">(</span>time <span class="op">=</span> <span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>y0 <span class="op">=</span> <span class="fl">1</span>, mumax <span class="op">=</span> <span class="fl">0.1</span>, K <span class="op">=</span> <span class="fl">10</span>, dK <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">## Fit the model ---------------------------------------------------------------</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_growthmodel.html">fit_growthmodel</a></span><span class="op">(</span><span class="va">grow_K_linear</span>,</span>
<span>                       p <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>y0 <span class="op">=</span> <span class="fl">1</span>, mumax <span class="op">=</span> <span class="fl">0.1</span>, K <span class="op">=</span> <span class="fl">10</span>, dK <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>, time <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Unload DLL and cleanup ------------------------------------------------------</span></span>
<span><span class="co">## DLL creation should ideally be directed to a temporary directory.</span></span>
<span><span class="va">dll</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">ode_K_linear</span>, <span class="va">.Platform</span><span class="op">$</span><span class="va">dynlib.ext</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dynload.html" class="external-link">dyn.unload</a></span><span class="op">(</span><span class="va">dll</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/unlink.html" class="external-link">unlink</a></span><span class="op">(</span><span class="va">dll</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/unlink.html" class="external-link">unlink</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">ode_K_linear</span>, <span class="st">".c"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/unlink.html" class="external-link">unlink</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">ode_K_linear</span>, <span class="st">".o"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="acknowledgments">Acknowledgments<a class="anchor" aria-label="anchor" href="#acknowledgments"></a>
</h2>
<p>Many thanks to Claudia Seiler for the data set, to David Kneis for
fruitful discussions, to Daniel Kaschek for his <strong>cOde</strong>
package, and to the R Core Team <span class="citation">(R Core Team
2015)</span> for developing and maintaining <strong>R</strong>. This
documentation was written using <strong>knitr</strong> <span class="citation">(Xie 2014)</span> and <strong>rmarkdown</strong> <span class="citation">(Allaire et al. 2015)</span>.</p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-rmarkdown" class="csl-entry">
Allaire, JJ, Joe Cheng, Yihui Xie, Jonathan McPherson, Winston Chang,
Jeff Allen, Hadley Wickham, and Rob Hyndman. 2015. <em><span class="nocase">rmarkdown</span>: Dynamic Documents for r</em>. <a href="https://CRAN.R-project.org/package=rmarkdown" class="external-link">https://CRAN.R-project.org/package=rmarkdown</a>.
</div>
<div id="ref-Kaschek2016" class="csl-entry">
Kaschek, Daniel. 2016. <em><span class="nocase">c</span>ode: Automated
<span>C</span> Code Generation for Use with the <span class="nocase">d</span>eSolve and <span class="nocase">b</span>vpSolve
Packages</em>. <a href="https://CRAN.R-project.org/package=cOde" class="external-link">https://CRAN.R-project.org/package=cOde</a>.
</div>
<div id="ref-Kneis2016" class="csl-entry">
Kneis, David. 2016. <em><span class="nocase">r</span>odeo: Handling of
ODE-Models as r Objects</em>. <a href="https://github.com/dkneis/rodeo" class="external-link">https://github.com/dkneis/rodeo</a>.
</div>
<div id="ref-Kneis2017" class="csl-entry">
Kneis, David, Thomas Petzoldt, and Thomas U. Berendonk. 2017. <span>“An
r-Package to Boost Fitness and Life Expectancy of Environmental
Models.”</span> <em>Environmental Modelling &amp; Software</em> 96:
123–27. https://doi.org/<a href="https://doi.org/10.1016/j.envsoft.2017.06.036" class="external-link">https://doi.org/10.1016/j.envsoft.2017.06.036</a>.
</div>
<div id="ref-RCore2015" class="csl-entry">
R Core Team. 2015. <em>R: A Language and Environment for Statistical
Computing</em>. Vienna, Austria: R Foundation for Statistical Computing.
<a href="https://www.R-project.org/" class="external-link">https://www.R-project.org/</a>.
</div>
<div id="ref-Soetaert2010c" class="csl-entry">
Soetaert, Karline, Thomas Petzoldt, and R. Woodrow Setzer. 2010.
<span>“<span class="nocase">Solving Differential Equations in
R</span>.”</span> <em>The R Journal</em> 2 (2): 5–15. <a href="https://journal.r-project.org/archive/2010-2/RJournal_2010-2_Soetaert~et~al.pdf" class="external-link">https://journal.r-project.org/archive/2010-2/RJournal_2010-2_Soetaert~et~al.pdf</a>.
</div>
<div id="ref-knitr2014" class="csl-entry">
Xie, Yihui. 2014. <span>“<span class="nocase">knitr</span>: A
Comprehensive Tool for Reproducible Research in <span>R</span>.”</span>
In <em>Implementing Reproducible Computational Research</em>, edited by
Victoria Stodden, Friedrich Leisch, and Roger D. Peng. Chapman;
Hall/CRC. <a href="https://www.routledge.com/Implementing-Reproducible-Research/Stodden-Leisch-Peng/p/book/9781466561595" class="external-link">https://www.routledge.com/Implementing-Reproducible-Research/Stodden-Leisch-Peng/p/book/9781466561595</a>.
</div>
</div>
<hr>
<p><strong>Copyright and original author:</strong> <a href="https://github.com/tpetzoldt" class="external-link">tpetzoldt</a>, 2025-08-28</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Thomas Petzoldt.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
